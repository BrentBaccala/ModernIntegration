
\mychapter{The Logarithmic Extension}

Our basic strategy for integration is to always work in the top most
field extension, reducing to some kind of problem that must be
solved in the next lower extension.

For logarithmic extensions, the problem is particularly easy,
since integration leads only to futher integration steps
in the base field.

\vfill\eject
\section{The Logarithmic Integration Theorem}

\theorem\label{logarithmic integration theorem}
Let $K$ be a differential field, let $K(\theta = \ln k)$ be a simple
logarithmic extension of $K$, let $n_i(\theta)$ be
irreducible polynomials in $K[\theta]$,
and let $f$ be an element of $K(\theta)$
with partial fractions expansion:

\begin{equation}
\label{logarithmic integration theorem - integrand}
f = \sum_{i=0}^n a_i \theta^i
+ \sum_{i=1}^\nu \sum_{j=1}^{m_i} \frac{b_{i,j}(\theta)}{n_i(\theta)^j}
\end{equation}

$$a_i \in K \qquad b_{i,j}(\theta),n_i(\theta) \in K[\theta]$$

If $f$ has
an elementary anti-derivative $F$, then $F \in K(\theta, \Psi)$,
where $K(\theta, \Psi)$ is a finite logarithmic extension
of $K(\theta)$, $F$ has a partial fractions expansion of the form:

\newcommand{\overbar}[1]{\mkern 1.5mu\overline{\mkern-1.5mu#1\mkern-1.5mu}\mkern 1.5mu}

\begin{equation}
\label{logarithmic integration theorem - integral}
F = c_{n+1} \theta^{n+1} + \sum_{i=1}^{n} \left[ A_i + c_i \right] \theta^i + \overbar{A_0}
+ \sum_{i=1}^\nu \sum_{j=1}^{m_i-1} \frac{B_{i,j}(\theta)}{n_i(\theta)^j}
+ \sum_{i=1}^\nu C_i \Psi_i
\end{equation}

%% $$\overbar{A_0} \in K[\Psi] \qquad {A_i \in K}_{i \ne 0} \qquad B_{i,j}(\theta),n_i(\theta) \in K[\theta] \qquad c_i' = C_i' = 0$$
\begin{equation*}
\arraycolsep=10pt\def\arraystretch{0}
\begin{array}{cccc}
\overbar{A_0} \in K[\Psi] & A_i \in K & B_{i,j}(\theta),n_i(\theta) \in K[\theta] & c_i' = C_i' = 0 \\
& {}_{i \ne 0} & &
\end{array}
\end{equation*}

and the following relationships hold:

%% $$ A_{n+1}' = 0 \qquad A_i' = a_i - (i+1) \frac{k'}{k} A_{i+1}
%% \qquad (A_i - (i+1) c_{i+1} \theta)' = a_i - (i+1) \frac{k'}{k} A_{i+1} $$

$$ \left[ A_n + (n+1) c_{n+1} \theta \right]' = a_n $$

$$ \left[ A_i + (i+1) c_{i+1} \theta \right]' = a_i - (i+1) \frac{k'}{k} A_{i+1} \qquad {}_{1\le i<n}$$

$$ \left[ \overbar{A_0} + c_1 \theta \right]' = a_0 - \frac{k'}{k} A_{1} $$

$$ R_{i,m_i-1}(\theta) = b_{i,m_i}(\theta) $$

$$ B_{i,j}(\theta) \equiv - \frac{R_{i,j}(\theta)}{j n_i'(\theta) } \mod n_i(\theta)$$

$$ Q_{i,j}(\theta) = - \frac{R_{i,j}(\theta) + j B_{i,j}(\theta) n_i'(\theta)}{n_i(\theta)}$$

$$ R_{i,j}(\theta) = b_{i,j+1}(\theta) - B_{i,j+1}'(\theta) - Q_{i,j+1}(\theta) $$

$$ \Psi_i = \ln n_i(\theta)$$

$$ C_i = \frac{b_{i,1}(\theta) - B_{i,1}'(\theta) - Q_{i,1}(\theta)}{n_i'(\theta)} $$

%% $$ - j B_{i,j}(\theta) n_i'(\theta) = R_{i,j}(\theta) \mod n_i(\theta)$$

\proof

By Theorem \ref{weak Liouville theorem}, an elementary antiderivative
of $f$ can only exist in a finite logarithm extension $K(\theta, \Psi)$
of $K(\theta)$ and therefore must have the form:

$$F = R + \sum_{i=1}^\eta C_i \Psi_i$$

where $R \in K(\theta)$, and the $C_i$ are constants.

We can perform a partial fractions expansion on $R$:

$$F = \sum_{i=0}^N A_i \theta^i
+ \sum_{i=1}^\nu \sum_{j=1}^{M_i} \frac{B_{i,j}(\theta)}{n_i(\theta)^j}
+ \sum_{i=1}^\eta C_i \Psi_i$$

It will be convenient later to separate a constant from the $A_i$ terms,
so let's do that now:

$$F = \sum_{i=0}^N (A_i + c_i) \theta^i
+ \sum_{i=1}^\nu \sum_{j=1}^{M_i} \frac{B_{i,j}(\theta)}{n_i(\theta)^j}
+ \sum_{i=1}^\eta C_i \Psi_i$$

Our basic
logarithmic relationships:

$$\ln ab = \ln a + \ln b \qquad\qquad \ln\frac{a}{b} = \ln a - \ln b$$

allow us to assume, without loss of generality, that the $\Psi_i$'s
are logarithms of irreducible polynomials, so
let's differentiate, remembering that $\theta' = \frac{k'}{k}$:

$$F' = \sum_{i=0}^N \left[ A_i' \theta^i + i \frac{k'}{k} (A_i + c_i) \theta^{i-1} \right]
+ \sum_{i=1}^\nu \sum_{j=1}^{M_i} \frac{B_{i,j}'(\theta) n_i(\theta) - j B_{i,j}(\theta) n_i'(\theta)}{n_i(\theta)^{j+1}}
  + \sum_{i=1}^\nu C_i \frac{n_i'(\theta)}{n_i(\theta)}$$

\begin{comment}
$$F' = A_0' + \sum_{i=1}^N ( A_i' \theta^i + i \frac{k'}{k} (A_i + c_i) \theta^{i-1} )
+ \sum_{i=1}^\nu \sum_{j=1}^{M_i} \frac{B_{i,j}'(\theta) n_i(\theta) - j B_{i,j}(\theta) n_i'(\theta)}{n_i(\theta)^{j+1}}
  + \sum_{i=1}^\nu C_i \frac{n_i'(\theta)}{n_i(\theta)}$$
\end{comment}

\begin{comment}
\begin{multline*}
F' = \sum_{i=0}^{N-1} \left[ A_i' + (i+1) \frac{k'}{k} A_{i+1} \right] \theta^{i} + A_N' \theta^N \\
+ \sum_{i=1}^\nu \sum_{j=1}^{M_i} \frac{B_{i,j}'(\theta) n_i(\theta) - j B_{i,j}(\theta) n_i'(\theta)}{n_i(\theta)^{j+1}}
  + \sum_{i=1}^\nu C_i \frac{n_i'(\theta)}{n_i(\theta)}
\end{multline*}
\end{comment}

\begin{multline*}
F' = A_N' \theta^N + \sum_{i=0}^{N-1} \left[ A_i' + (i+1) \frac{k'}{k} (A_{i+1} + c_{i+1}) \right] \theta^{i} \\
+ \sum_{i=1}^\nu \left[ \frac{- M_i B_{i,M_i}(\theta) n_i'(\theta)}{n_i(\theta)^{M_i+1}} + \sum_{j=1}^{M_i-1} \frac{B_{i,j+1}'(\theta) - j B_{i,j}(\theta) n_i'(\theta)}{n_i(\theta)^{j+1}}
  + C_i \frac{n_i'(\theta)}{n_i(\theta)} \right]
\end{multline*}

$F'$ has the form of a partial fractions decomposition, but it is not
a partial fractions decomposition because the numerators in the $B$
terms violate the partial fractions degree bounds.  The problem
is that the product $B_{i,j}(\theta) n_i'(\theta)$ might
have degree greater than $\deg_\theta n_i(\theta)$.
To fix this, let's
divide the $-jB_{i,j}(\theta)n_i'(\theta)$ terms by $n_i(\theta)$
(think polynomial long division) and rewrite them as a quotient
and a remainder:

$$ - j B_{i,j}(\theta) n_i'(\theta) = Q_{i,j}(\theta) n_i(\theta) + R_{i,j}(\theta)$$

This fixes the $B$ terms, since $\deg Q_{i,j}(\theta) < \deg n_i(\theta)$
and $\deg R_{i,j}(\theta) < \deg n_i(\theta)$.

\begin{comment}
\begin{multline*}
F' = A_N' \theta^N + \sum_{i=0}^{N-1} \left[ A_i' + (i+1) \frac{k'}{k} (A_{i+1} + c_{i+1} \right] \theta^{i} \\
+ \sum_{i=1}^\nu \left[ \sum_{j=1}^{M_i} \frac{B_{i,j+1}'(\theta) + Q_{i,j+1}(\theta) + R_{i,j}(\theta)}{n_i(\theta)^{j+1}}
  + \frac{B_{i,1}'(\theta) + Q_{i,1}(\theta) + C_i n_i'(\theta)}{n_i(\theta)} \right]
\end{multline*}
\end{comment}

\begin{multline*}
F' = A_N' \theta^N + \sum_{i=0}^{N-1} \left[ A_i' + (i+1) \frac{k'}{k} (A_{i+1} + c_{i+1})\right] \theta^{i} \\
+ \sum_{i=1}^\nu \left[ \frac{R_{i,M_i}(\theta)}{n_i(\theta)^{M_i+1}}
+ \sum_{j=1}^{M_i-1} \frac{B_{i,j+1}'(\theta) + Q_{i,j+1}(\theta) + R_{i,j}(\theta)}{n_i(\theta)^{j+1}}
  + \frac{B_{i,1}'(\theta) + Q_{i,1}(\theta) + C_i n_i'(\theta)}{n_i(\theta)} \right]
\end{multline*}

What is the degree of $F'$?  It's $N$, if $A_N$ is not constant.  If $A_N$ is constant and not zero, then
the degree of $F'$ is $N-1$, since otherwise the $N-1$ coefficient would be zero:

$$A_{N-1}' + N \frac{k'}{k} A_N = 0  \qquad\Longrightarrow\qquad A_{N-1}' = (- N A_N ) \frac{k'}{k}$$

Since $A_N$ is constant, this could only be satisfied by $A_{N-1} = - N A_N \theta$,
contradicting the transcendence of $\theta$ (MORE DETAIL).

Performing a partial fractions decomposition of $f$:

$$f = \sum_{i=0}^n a_i \theta^i
+ \sum_{i=1}^\nu \sum_{j=1}^{m_i} \frac{b_{i,j}(\theta)}{n_i(\theta)^j}$$

setting $F' = f$ and equating like terms, we establish the
relationships listed in the statement of the theorem.

For the degree of $F'$ to be $n$, either $\deg_\theta F = n+1$ and $A_{n+1}$ is
constant, or $\deg_\theta F = n$.

Since the highest order denominators in $F'$ have order $M_i + 1$, and
they must match with $f$'s denominators of order $m_i$, we conclude
that $M_i = m_i - 1$.

To establish the remaining relationships, let's remember the definition of
$R_{i,j}$ and $Q_{i,j}$:

$$-j B_{i,j}(\theta)n_i'(\theta) = Q_{i,j}(\theta) n_i(\theta) + R_{i,j}(\theta)$$

Reducing this equation modulo $n_i(\theta)$, we obtain:

$$-j B_{i,j}(\theta)n_i'(\theta) \equiv R_{i,j}(\theta) \mod n_i(\theta)$$

Now we use the fact that $n_i(\theta)$ is {\it irreducible},
and invoke Theorem ??, which states the quotient ring
modulo a prime ideal is a field, so we can perform division:

$$ B_{i,j}(\theta) \equiv - \frac{R_{i,j}(\theta)}{jn_i'(\theta)} \mod n_i(\theta)$$

This equation seems to identify $B_{i,j}(\theta)$ up to a multiple of $n_i(\theta)$,
but if we remember our degree bound on partial fractions expansions,
$\deg_\theta B_{i,j}(\theta) < \deg_\theta n_i(\theta)$, we see
that in fact we've completely determined $B_{i,j}(\theta)$ from
$R_{i,j}(\theta)$.

\endtheorem

\vfill\eject

\example Compute $\int {1\over{x \ln x}} {\rm d}x$

Operating in ${\bf C}(x, \theta = \ln x)$, we evaluate:

$$\int {1\over{\theta x}} \ud x = \int {{1\over x}\over{\theta}} \ud x$$

This has the form of equation \eqref{logarithmic integration theorem - integrand}
with $n_1(\theta) = \theta$, $m_1 = 1$ and $b_{1,1}(\theta) = \frac{1}{x}$.

$$C_1 = \frac{b_{1,1}(\theta)}{n_1'(\theta)} = \frac{\frac{1}{x}}{\frac{1}{x}} = 1$$

Plugging $C_1$ into equation \eqref{logarithmic integration theorem - integral} we get:

$$\int {1\over{x \ln x}} {\rm d}x = \ln n_1(\theta) = \ln \ln x$$

\endexample

\example Compute $\int \ln x \,{\rm d}x$

Again we'll use ${\bf C}(x, \theta = \ln x)$

$$\int \theta \ud x$$

This has the form of equation \eqref{logarithmic integration theorem - integrand}
with $n=1$ and $a_1 = 1$, so

$$\left[ A_1 + 2 c_2 \theta \right]' = a_1 = 1$$

$$A_1 + 2 c_2 \theta = x$$

Since $A_1 \in {\bf C}(x)$, it can not involve $\theta$, so $A_1 = x$ and $c_2 = 0$.

\newcommand{\overbar}[1]{\mkern 1.5mu\overline{\mkern-1.5mu#1\mkern-1.5mu}\mkern 1.5mu}

$$\left[ \overbar{A_0} + c_1 \theta \right]' = a_0 - \frac{k'}{k} A_1 = 0 - \frac{1}{x} x = -1$$

$$\overbar{A_0} + c_1 \theta = -x$$

So $\overbar{A_0} = -x$ and $c_1 = 0$.  Plugging $\overbar{A_0}$, $A_1$, $c_1$ and $c_2$ into
equation \eqref{logarithmic integration theorem - integral} we get:

$$\int \theta \ud x = x\theta - x$$
$$\int \ln x \,{\rm d}x = x \ln x - x$$

\endexample

\vfill\eject

\example Compute $\int \tan^{-1} x\, {\rm d}x$

\begin{comment}

The ``standard'' approach to this integral would be to note that the
derivative of $\tan^{-1} x$ is $1/(x^2+1)$ and use integration by parts:

$$\int \tan^{-1} x\, {\rm d}x = x\, \tan^{-1}x - \int \frac{x\, {\rm d}x}{x^2+1}
= x\, \tan^{-1}x - \ln(x^2+1) + C$$

\end{comment}

Using the differential algebra identity $\tan^{-1} x =
{1\over2}\,i\,\ln {{ix-1}\over{ix+1}}$ from
Section \ref{sec:Liouvillian Forms}, we use the differential field
${\mathbb C}(x,\theta)$; $\theta = \ln {{ix-1}\over{ix+1}}$; $\theta'
= - \frac{2i}{x^2+1}$ and compute

% {1\over2}\,i\,\ln {{ix-1}\over{ix+1}}

$$\int {1\over2}\,i\,\theta\, {\rm d}x$$

This is in the form of equation \eqref{logarithmic integration theorem - integrand}
with $n=1$ and $a_1=\frac{1}{2}i$, so
Theorem \ref{logarithmic integration theorem} tells us that
the $\theta$-degree of our integral is at most two, and
$A_2$ is a constant.

$$A_1' = a_1 - 2 A_2 \frac{k'}{k} = {1\over2}\,i + 2 A_2 \frac{2i}{x^2+1}$$

Since $A_1 \in {\mathbb C}(x)$, $A_2$ is zero and $A_1 = \frac{1}{2}ix + C$.

$$A_0' = a_0 - A_1 \frac{k'}{k} = (\frac{1}{2}ix + C_1) \frac{2i}{x^2+1}$$

\begin{comment}
Integrating both sides we obtain:

$$c_2\theta + a_1 = {1\over2}\,i\,x + c_1$$

Equating coefficients again (and remembering that
$a_1 \in {\mathbb C}(x)$) leads us to conclude that

$$c_2=0 \qquad a_1 = {1\over2}\,i\,x + c_1$$

Finally,

$$a_1\theta' + a_0' = 0$$
$$\left({1\over2}\,i\,x + c_1\right)\theta' + a_0' = 0$$

Since $c_1$ is unknown, we'll leave it on the left-hand side along
with the unknown $a_0$ and move all of our knowns to the right-hand
side, taking advantage of our knowledge of $\theta'$:

$$c_1\theta' + a_0' = {1\over2}\,i\,x \frac{2i}{x^2+1}$$
\end{comment}

$$C_1\theta' + A_0' = - \frac{x}{x^2+1}$$

Integrating both side we obtain:

$$C_1\theta + A_0 = - \ln(x^2+1)$$

and remembering that $A_0$ can include new logarithmic extensions, we
conclude that

$$C_1 = 0 \qquad A_0 = - \ln(x^2+1)$$

and therefore our solution is:

$$\int {1\over2}\,i\,\theta\, {\rm d}x = {1\over2}\,i\,x \theta - \ln(x^2+1)$$
$$\int \tan^{-1} x\, {\rm d}x = x\,\tan^{-1} x - \ln(x^2+1)$$


\endexample

\example Determine if $\sum_{n=0}^\infty \frac{1}{n^2} x^n$ is elementary.

We can differentiate the series term wise, and if the resulting series
can be identified with an elementary function, then we need only to
decide if that derivative can be integrated into an elementary
function.  Using a standard identity for the Taylor series of $\ln
(1-x)$, we determine that

$$\frac{\ud}{\ud x} \left[ \sum_{n=0}^\infty \frac{1}{n^2} x^n \right] = \sum_{n=1}^\infty \frac{1}{n} x^{n-1} = \frac{1}{x}\ln (1-x)$$

so we need to determine if $\int \frac{1}{x}\ln (1-x) \ud x$ is elementary.  Working in the
differential field ${\mathbb C}(x,\theta = \ln (1-x))$, we're trying to integrate
$\frac{1}{x}\theta \ud x$.  So, our integral must have the form

$$I = c_2 \theta^2 + a_1 \theta + \bar{a_0}$$

$$I' = \left[ c_2 \frac{1}{1-x} + a_1' \right] \theta + \left[ a_1 \frac{1}{1-x} + \bar{a_0}' \right] = \frac{1}{x}\theta$$

$$c_2 \frac{1}{1-x} + a_1' = \frac{1}{x}$$

$$a_1' = \frac{1}{x} - c_2 \frac{1}{1-x}$$

$\ln x$ is required to express $a_1$, but new logarithms are not
allowed at this point in the algorithm.  Therefore,
$\sum_{n=0}^\infty \frac{1}{n^2} x^n$ is not elementary.

\endexample

\vfill\eject

\example\label{hard log-exp integral}
Compute

%% $$\int{{x(x+1)\{(x^2e^{2x^2}-\ln^2(x+1))^2+2xe^{3x^2}(x-(2x^3+2x^2+x+1)\ln(x+1))\}}\over{((x+1)\ln^2(x+1) - (x^3+x^2)e^{2x^2})^2}} dx$$

$$\int{{x\{(x^2e^{2x^2}-\ln^2(x+1))^2+2xe^{3x^2}(x-(2x^3+2x^2+x+1)\ln(x+1))\}}\over{(x+1)(\ln^2(x+1) - x^2e^{2x^2})^2}} dx$$

We begin by putting our integral into Liouvillian form, assigning $\psi = \exp(x^2)$ and $\theta = \ln (x+1)$ to obtain:

%% $$\int{{x(x+1)\{(x^2 \psi^2-\theta^2)^2+2x \psi^3(x-(2x^3+2x^2+x+1)\theta)\}}\over{((x+1)\theta^2 - (x^3+x^2)\psi^2)^2}} dx$$

%% Cancelling $x+1$ between the numerator and denominator:

$$\int{{x\{(x^2 \psi^2-\theta^2)^2+2x \psi^3(x-(2x^3+2x^2+x+1)\theta)\}}\over{(x+1)(\theta^2 - x^2\psi^2)^2}} dx$$

Since $\psi$ and $\theta$ are both simple extensions of ${\mathbb C}(x)$, we can operate in either
${\mathbb C}(x,\psi,\theta)$ or ${\mathbb C}(x,\theta,\psi)$.  Since ${\mathbb C}(x,\theta,\psi)$
is an exponential extension of ${\mathbb C}(x,\theta)$, working in ${\mathbb C}(x,\theta,\psi)$
would require evaluating an integral in an exponential extension, which we won't study until
the next chapter.  Therefore, we'll work in ${\mathbb C}(x,\psi,\theta)$, a logarithmic
extension of ${\mathbb C}(x,\psi)$, and hope that we won't have to do anything
too complicated in ${\mathbb C}(x,\psi)$!

We need to put our integrand into partial fractions form, so let's begin by
using Maxima's {\tt divide} function, which performs polynomial long division
with respect to a specific variable, and obtain:


{\small\begin{verbatim}

(%i1) divide(expand(x*((x^2*p^2-t^2)^2 + 2*x*p^3*(x-(2*x^3+2*x^2+x+1)*t))),
                expand((x+1)*(t^2-x^2*p^2)^2), t);

                    x            3  5      3  4      3  3      3  2       3  3
(%o1)            [-----, t (- 4 p  x  - 4 p  x  - 2 p  x  - 2 p  x ) + 2 p  x ]
                  x + 1

\end{verbatim}}

% {\LARGE$$\int {x\over{x+1}} dx +  \int{{{{-4x^5-4x^4-2x^3-2x^2}\over{x+1}}\psi^3\theta + {{2x^3}\over{x+1}}\psi^3}\over{(\theta^2 - x^2\psi^2)^2}} dx$$}

% {\LARGE$$\int {x\over{x+1}} + {(-4x^5-4x^4-2x^3-2x^2)\psi^3\theta + {2x^3}\psi^3}\over{(x+1)(\theta^2 - x^2\psi^2)^2} dx$$}
$$\int {x\over{x+1}} + {{(-4x^5-4x^4-2x^3-2x^2)\psi^3\theta + {2x^3}\psi^3}\over{(x+1)(\theta^2 - x^2\psi^2)^2}} dx$$

% {\LARGE$$\int {x\over{x+1}} dx +  \int{{{{-4x^5-4x^4-2x^3-2x^2}\over{x+1}}\psi^3\theta + {{2x^3}\over{x+1}}\psi^3}\over{(\theta^2 - x^2\psi^2)^2}} dx$$}

The $\frac{x}{x+1}$ term is easy, so let's consider the fractional
term.  Polynomial factorization can be difficult, but this denominator
is easy -- it's just a difference of squares: $(\theta^2 - x^2\psi^2) = (\theta-x\psi)(\theta+x\psi)$.
Maxima's {\tt partfrac} function performs partial fractions
expansion with respect to a given variable, in this case $\theta$.


\vfill\eject

{\small\begin{verbatim}

(%i4) partfrac(%o1[2]/((x+1)*(t^2-x^2*p^2)^2), t);
               1                     1
(%o4) ------------------- - -------------------
      (2 x + 2) (p x + t)   (2 x + 2) (t - p x)
     2           2  2      2  3      2  4
   (p  + p) x + p  x  + 2 p  x  + 2 p  x
 + --------------------------------------
                               2
            (2 x + 2) (t + p x)
     2           2  2      2  3      2  4
   (p  - p) x + p  x  + 2 p  x  + 2 p  x
 - --------------------------------------
                               2
            (2 x + 2) (t - p x)
\end{verbatim}}

\begin{comment}
\begin{multline*}
\int {x\over{x+1}} + \frac{(2x^4+2x^3+x^2+x)\psi^2 + x \psi}{2(x+1)(\theta + x \psi)^2}
       + \frac{1}{2(x+1)(\theta + x \psi)} \\
       - \frac{(2x^4+2x^3+x^2+x)\psi^2 - x \psi}{2(x+1)(\theta - x \psi)^2}
       - \frac{1}{2(x+1)(\theta - x \psi)} dx$$
\end{multline*}
\end{comment}

\begin{multline*}
\int {x\over{x+1}} + \frac{\frac{2x^4+2x^3+x^2+x}{2(x+1)}\psi^2 + \frac{x}{2(x+1)} \psi}{(\theta + x \psi)^2}
       + \frac{\frac{1}{2(x+1)}}{(\theta + x \psi)} \\
       - \frac{\frac{2x^4+2x^3+x^2+x}{2(x+1)}\psi^2 - \frac{x}{2(x+1)} \psi}{(\theta - x \psi)^2}
       - \frac{\frac{1}{2(x+1)}}{(\theta - x \psi)} dx
\end{multline*}


We have two irreducible factors: $n_1(\theta) = \theta + x \psi$ and
$n_2(\theta) = \theta - x \psi$.  Each has $\theta$-degree 1, so
the numerators in our partial fractions expansions have
$\theta$-degree 0, as expected.

Now we're ready to apply
Theorem \ref{logarithmic integration theorem}.  Let's start with
$n_1(\theta)$.  $m_{1,1}=2$, so

$$R_{1,1}(\theta) = b_{1,2}(\theta) = \frac{2x^4+2x^3+x^2+x}{2(x+1)}\psi^2 + \frac{x}{2(x+1)} \psi$$

and we wish to compute

$$ B_{1,1}(\theta) \equiv - \frac{R_{1,1}(\theta)}{n_1'(\theta) } \mod n_1(\theta)$$

As modulo calculations go, this one is easy. $n_1'(\theta) = \frac{1}{x+1} + (1 + 2 x^2) \psi$

$$ B_{1,1}(\theta) = - \frac{\frac{2x^4+2x^3+x^2+x}{2(x+1)}\psi^2 + \frac{x}{2(x+1)} \psi}{\frac{1}{x+1} + (1 + 2 x^2) \psi}$$

$$ = - \frac{\frac{2x^4+2x^3+x^2+x}{2}\psi^2 + \frac{x}{2} \psi}{1 + (x+1)(1 + 2 x^2) \psi}$$

%% $$ = \frac{\frac{2x^4+2x^3+x^2+x}{2}\psi^2 + \frac{x}{2} \psi}{1 + (2 x^3 + 2 x^2 + x + 1) \psi}$$

$$ = - \frac{\frac{x}{2}\psi ( (2x^3+2x^2+x+1)\psi + 1)}{1 + (2 x^3 + 2 x^2 + x + 1) \psi}$$

$$ = - \frac{x}{2}\psi$$

Now we wish to compute $Q_{1,1}(\theta)$:

$$ Q_{1,1}(\theta) = - \frac{R_{1,1}(\theta) + B_{1,1}(\theta) n_1'(\theta)}{n_1(\theta)}$$

$$ Q_{1,1}(\theta) = - \frac{\frac{2x^4+2x^3+x^2+x}{2(x+1)}\psi^2 + \frac{x}{2(x+1)} \psi - \frac{x}{2}\psi \left[\frac{1}{x+1} + (1 + 2 x^2) \psi\right]}{\theta + x \psi} = 0$$

This division to obtain $Q_{1,1}$ will always be exact.  What might not be exact is the following division
to obtain $C_{1}$.  If the division isn't exact, or if $C_1$ isn't a constant, then the integral is not elementary.

$$ C_1 = \frac{b_{1,1}(\theta) - B_{1,1}'(\theta) - Q_{1,1}(\theta)}{n_1'(\theta)} $$

$$B_{1,1}(\theta) = -\frac{x}{2}\psi \qquad\Longrightarrow\qquad B_{1,1}' = -\frac{2x^2+1}{2}\psi$$

$$ C_1 = \frac{\frac{1}{2(x+1)} + \frac{2x^2+1}{2}\psi}{\frac{1}{x+1} + (1 + 2 x^2) \psi} = \frac{1}{2}$$

A similar calculation yields

$$B_{2,1}(\theta) = -\frac{x}{2}\psi \qquad C_2 = -\frac{1}{2}$$

Plugging everything together, we conclude that:

\begin{multline*}
\int{{x\{(x^2 \psi^2-\theta^2)^2+2x \psi^3(x-(2x^3+2x^2+x+1)\theta)\}}\over{(x+1)(\theta^2 - x^2\psi^2)^2}} dx \\
= x - \theta -\frac{\frac{x}{2}\psi}{\theta + x \psi} - \frac{\frac{x}{2}\psi}{\theta - x \psi} + \frac{1}{2}\ln(\theta + x\psi)- \frac{1}{2}\ln(\theta - x \psi)
\end{multline*}

$$ = x - \theta -\frac{x \psi \theta}{\theta^2 - x^2 \psi^2} + \frac{1}{2}\ln\frac{\theta + x\psi}{\theta - x \psi}$$

Converting back to our original form:

$$\int{{x\{(x^2e^{2x^2}-\ln^2(x+1))^2+2xe^{3x^2}(x-(2x^3+2x^2+x+1)\ln(x+1))\}}\over{(x+1)(\ln^2(x+1) - x^2e^{2x^2})^2}} dx$$
$$= x - \ln(x+1) - {x e^{x^2}\ln(x+1)\over{\ln^2(x+1)-x^2 e^{2x^2}}}
+ {1\over2}\ln\frac{\ln(x+1) + x e^{x^2}}{\ln(x+1) - x e^{x^2}}$$

\endexample

\vfill\eject

\section{Hermite Reduction}

Another, more efficient, approach to handling the polynomials in
denominators is to reduce their order until our denominator has only
factors of multiplicity one.  We're attempting to do this:

$$\int {N\over{V^n}} = {A\over{V^{n-1}}} + \int {B\over{V^{n-1}}}$$

Differentiating:

$${N\over{V^n}} = {A'\over{V^{n-1}}} - (n-1){AV'\over{V^n}} + {B\over{V^{n-1}}}$$

and multiplying through by $V^n$:

$$N = VA' - (n-1)AV' + BV$$
$$N = (A'+B)V - (n-1)AV'$$

This equation has the form of a polynomial Diophantine equation, and
since we know $N$, $V$ and $V'$, we can use the extended Euclidian
algorithm to find $(n-1)A$ and $(A'+B)$, which easily gives us $A$ and
$B$.  So long as $V$ is square-free, we know that $\gcd(V,V')=1$
(EXPLAIN), so we're guaranteed a solution (STATE THEOREM).

\example
Redo Example \ref{hard log-exp integral} using Hermite reduction.

$$\int{{x\{(x^2e^{2x^2}-\ln^2(x+1))^2+2xe^{3x^2}(x-(2x^3+2x^2+x+1)\ln(x+1))\}}\over{(x+1)(\ln^2(x+1) - x^2e^{2x^2})^2}} dx$$

We proceed as before, putting the integral into Liouvillian form
and dividing out $\frac{x}{x+1}$ to obtain a proper fraction:

$$\int {x\over{x+1}} + {{(-4x^5-4x^4-2x^3-2x^2)\psi^3\theta + {2x^3}\psi^3}\over{(x+1)(\theta^2 - x^2\psi^2)^2}} dx$$

Now we apply the Hermite reduction, using:

$$V = \theta^2 - x^2\psi^2 \qquad V' = {2\over{x+1}}\theta - (2x+4x^3)\psi^2$$

$$N = {{{-4x^5-4x^4-2x^3-2x^2}\over{x+1}}\psi^3\theta + {{2x^3}\over{x+1}}\psi^3} $$

\vfill\eject

Our polynomial Diophantine equation is:

$${{{-4x^5-4x^4-2x^3-2x^2}\over{x+1}}\psi^3\theta + {{2x^3}\over{x+1}}\psi^3}
  = sV + tV'$$

{\small\begin{verbatim}

(%i353) v: t^2-x^2*p^2;

                                              2    2  2
(%o353)                                      t  - p  x
(%i354) vtick: (2/(x+1))*t-(2*x+4*x^3)*p^2;

                                       2 t     2     3
(%o354)                               ----- - p  (4 x  + 2 x)
                                      x + 1
(%i355) r: gcdex(v,vtick,t) * (((-4*x^5-4*x^4-2*x^3-2*x^2)/(x+1))*p^3*t + (2*x^3/(x+1))*p^3);

                   3         5      4      3      2       3  3
                  p  t (- 4 x  - 4 x  - 2 x  - 2 x )   2 p  x
                  ---------------------------------- + -------
                                x + 1                   x + 1
(%o355)/R/ [---------------------------------------------------------,
             4     8      7      6      5      4      3    2     2  2
            p  (4 x  + 8 x  + 8 x  + 8 x  + 5 x  + 2 x  + x ) - p  x

     3      2             2        7      6      5      4      3      2       3
((2 x  + 2 x  + x + 1) p t  + ((4 x  + 8 x  + 8 x  + 8 x  + 5 x  + 2 x  + x) p  - x p) t

         5      4    3    2   3       6      5      4      3      2             2
 + (- 2 x  - 2 x  - x  - x ) p )/((4 x  + 8 x  + 8 x  + 8 x  + 5 x  + 2 x + 1) p  - 1),

      5      4      3      2   3        3  3
  (4 x  + 4 x  + 2 x  + 2 x ) p  t - 2 x  p
- ------------------------------------------]
                    x + 1
(%i356) ratsimp(r[1] - divide(r[1],vtick,t)[1]*vtick);

                                                2 p x
(%o356)                                       - -----
                                                x + 1
(%i357) ratsimp(r[2] + divide(r[1],vtick,t)[1]*v);

(%o357)                                        p t x

\end{verbatim}}

So, our solution is:

$${{{-4x^5-4x^4-2x^3-2x^2}\over{x+1}}\psi^3\theta + {{2x^3}\over{x+1}}\psi^3}
  = {-2x\over{x+1}}\psi V + x\psi\theta V'$$

$$A = -x\psi\theta$$
$$A' = -\psi\theta - x(2x)\psi\theta - x\psi{1\over{x+1}}$$
$$A' + B = {-2x\over{x+1}}\psi$$
$$B = (2x^2+1)\psi\theta - {x\over{x+1}}\psi$$

Which reduces our integral to:

%% {\LARGE$$\int {x\over{x+1}} - {x\psi\theta\over{\theta^2-x^2\psi^2}} +  \int{{(2x^2+1)\psi\theta - {x\over{x+1}}\psi}\over{\theta^2-x^2\psi^2}} dx$$}

{\LARGE$$x - \theta - {x\psi\theta\over{\theta^2-x^2\psi^2}} +  \int{{(2x^2+1)\psi\theta - {x\over{x+1}}\psi}\over{\theta^2-x^2\psi^2}}$$}

%% \vfill\eject

%% {\LARGE$$x - \theta - {x\psi\theta\over{\theta^2-x^2\psi^2}} +  \int{{(2x^2+1)\psi\theta - {x\over{x+1}}\psi}\over{\theta^2-x^2\psi^2}}$$}

Now we can compute a Rothstein-Trager resultant:

{\small\begin{verbatim}

(%i374) resultant((2*x^2+1)*p*t-(x/(x+1))*p-z*vtick,v,t);

         2  2     2  6      2  5      2  4      2  3      2  2      2      2          2
(%o374) p  x  (4 p  x  + 8 p  x  + 8 p  x  + 8 p  x  + 5 p  x  + 2 p  x + p  - 1) (4 z  - 1)
\end{verbatim}}

This result is in ${\mathbb C}(x,\psi)[z]$, so the first two factors are just
{\it content} (EXPLAIN THIS TERM).  The result is really just $4z^2-1$,
which has two solutions: $\pm\frac{1}{2}$.  Substituting in these two
values for $z$, we obtain the corresponding logarithms:

{\small\begin{verbatim}
(%i375) gcd((2*x^2+1)*p*t-(x/(x+1))*p-(1/2)*vtick,v);

                                              p x + t
(%o375)                                       -------
                                               x + 1
(%i376) gcd((2*x^2+1)*p*t-(x/(x+1))*p+(1/2)*vtick,v);

                                              p x - t
(%o376)                                       -------
                                               x + 1
\end{verbatim}}

{\LARGE$$x - \theta - {x\psi\theta\over{\theta^2-x^2\psi^2}} + {1\over2}\ln({{\theta + x \psi}\over{x+1}}) - {1\over2}\ln({{\theta - x \psi}\over{x+1}})$$}

% \vskip 2in

$$\int{{x(x+1)\{(x^2e^{2x^2}-\ln^2(x+1))^2+2xe^{3x^2}(x-(2x^3+2x^2+x+1)\ln(x+1))\}}\over{((x+1)\ln^2(x+1) - (x^3+x^2)e^{2x^2})^2}} dx$$

{\LARGE$$= x - \theta - {x\psi\theta\over{\theta^2-x^2\psi^2}} + {1\over2}\ln(\theta + x \psi) - {1\over2}\ln(\theta - x \psi)$$}

$$= x - \ln(x+1) - {x e^{x^2}\ln(x+1)\over{\ln^2(x+1)-x^2 e^{2x^2}}}$$
$$+ {1\over2}\ln\left[\ln(x+1) + x e^{x^2}\right] - {1\over2}\ln\left[\ln(x+1) - x e^{x^2}\right]$$

\endexample
